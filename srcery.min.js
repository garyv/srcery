// Srcery -> http://github.com/garyv/srcery
var Srcery=function(){var f={delay:400,eagerness:3,batchLength:6},l=document,m=window,q=0,n=0,b,k,r,g,s,d,t,w,x,e,c,u,p,y,v,h;c=function(){return arguments.length-2?c(arguments[0],arguments[1])!=arguments[2]&&arguments[0].setAttribute(arguments[1],arguments[2]):arguments[0].getAttribute(arguments[1])};u=function(){imgs=l.querySelectorAll?l.querySelectorAll("img[data-srcset]"):l.getElementsByTagName("img")};p=function(a,b){m.addEventListener?this.addEventListener(a,b,!1):m.attachEvent?this.attachEvent("on"+ a,b):this["on"+a]=b};y=function(a){if(c(a,"data-original-src"))return!0;a=a.getBoundingClientRect();return a.left>=0-f.eagerness*viewportHeight()&&a.top<=f.eagerness*viewportHeight()};loadSrc=function(a,b){c(a,"src")!=b&&(q+=1,c(a,"src",b))};v=function(a){if(d=c(a,"data-srcset"))for(c(a,"data-original-src")||c(a,"data-original-src",c(a,"src")),d=d.split(/, ?/),g=0;g<d.length;g++)if(d[g].match(/\dw$/)){if(x=+d[g].match(/\d+(?=w$)/),x<=w){s=d[g].split(/ /)[0];loadSrc(a,s);break}}else s=d[g].split(/ /)[0], loadSrc(a,s)};h=function(){if(k)e||(e=!0,setTimeout(function(){k&&(k=e=!1,h())},f.delay));else for(k=!0,w=viewportWidth(),e=!1,r=imgs.length,n==n?0:n,b=n;b<r;b++)if(q<f.batchLength)y(imgs[b])&&v(imgs[b]);else if(!e){e=!0;setTimeout(function(){q=e=0;n=b;h()},f.delay/10);break}};viewportHeight=function(){return t=t||m.innerHeight||l.documentElement.clientHeight};viewportWidth=function(){return(m.innerWidth||l.body.parentNode.clientWidth)*(m.devicePixelRatio||1)};e=k=!1;u();p("load",h);p("orientationchange", function(){t=0;k=!1;h()});p("scroll",h);p("orientationchange",h);!imgs.length&&setTimeout(u,f.delay);return{set:function(a){for(var b in a)a.hasOwnProperty(b)&&(f[b]=a[b])},push:function(a){return imgs.push(a)},now:function(){b=0;for(r=imgs.length;b<r;b++)v(imgs[b])}}}();
